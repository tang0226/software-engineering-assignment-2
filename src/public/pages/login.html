<!doctype html>
<html>
  <head>
    <title>Login page</title>
    <link rel="stylesheet" href="../css/global.css" />
  </head>
  <body>
    <div class="header">Login</div>
    <div id="login-message" style="color: red"></div>
    <form id="login-form">
      <div>
        Username / Email: <input type="text" name="username" />
      </div>
      <div>
        Password: <input type="password" id="password-input" name="password" />
      </div>
      <div>
        <input type="checkbox" id="checkbox" /> Show password
      </div>
      <input type="submit" id="checkbox" value="Login" />
    </form>

    <script type="text/javascript">
      const passwordInput = document.querySelector('#password-input');
      const checkbox = document.querySelector('#checkbox');
      checkbox.addEventListener('change', () => {
        passwordInput.setAttribute('type',  checkbox.checked ? 'text' : 'password');
      });
      
      const form = document.querySelector('#login-form');
      const loginMsg = document.querySelector('#login-message');
      
      async function submitLogin() {
        const formData = new FormData(form);
        try {
          const response = await fetch('/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(Object.fromEntries(formData.entries())),
          });
          const data = await response.json();
          if (data.error) {
            loginMsg.innerText = data.message;
          }
          else {
            window.location.href = data.redirect;
          }
        } catch (e) {
          console.error(e);
        }
      }
      
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        submitLogin();
      });
    </script>
  </body>
</html>
